#!/usr/bin/env bash
cd "$(dirname "${0}")"

menu(){
  while :
  do
    clear
    echo -ne "

    ███████╗███████╗██████╗  ██████╗ ██████╗  █████╗                           
    ██╔════╝██╔════╝██╔══██╗██╔═══██╗██╔══██╗██╔══██╗                          
    █████╗  █████╗  ██║  ██║██║   ██║██████╔╝███████║                          
    ██╔══╝  ██╔══╝  ██║  ██║██║   ██║██╔══██╗██╔══██║                          
    ██║     ███████╗██████╔╝╚██████╔╝██║  ██║██║  ██║                          
    ╚═╝     ╚══════╝╚═════╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝                          

    d) Dnf setup
    c) Command line tools
    f) Flatpaks
    i) Fisher
    r) Git Repos
    s) Ssh Keygen
    v) Virtualization
    
    g) Gnome
    k) Kde
    
    o) Os-Tree Update
    p) Os-Tree Layers
    h) Gnome (OS-Tree)
  
    Select Version:"
    read -r version
    case $version in
      c) clis ;;
      d) dnf_setup ;;
      f) ./extras/flatpaks ;;
      g) gnome ;;
      h) gnome-ostree  ;;
      i) ./extras/fisher ;;
      k) kde ;;
      n) snapper_with_dnf ;;
      o) sudo rpm-ostree upgrade ;;
      p) rpm-ostree install alacritty virt-manager ;;
      r) ./extras/git-clones ;;
      s) ./extras/keygen ;;
      v) virt ;;
      *) echo "Not a valid option"
         exit 1
         ;;
    esac
  done
}


clis(){
  # clis
  sudo dnf -y install bat 
  sudo dnf -y install exa
  sudo dnf -y install entr
  sudo dnf -y install fd-find
  sudo dnf -y install fish
  sudo dnf -y install fortune-mod
  sudo dnf -y install fzf
  sudo dnf -y install gitui
  sudo dnf -y install hledger
  sudo dnf -y install megacmd
  sudo dnf -y install ripgrep
  sudo dnf -y install tealdeer
  sudo dnf -y install jetbrains-mono-fonts

  #helix editor
  sudo dnf -y copr enable varlad/helix
  sudo dnf -y install helix

  # neovim
  sudo dnf -y install gcc "gcc-c++" glibc-all-langpacks
  sudo dnf -y install neovim && git clone --depth 1 https://github.com/wbthomason/packer.nvim ~/.local/share/nvim/site/pack/packer/start/packer.nvim

  # rust
  sudo dnf -y install openssl openssl-devel 
  source ./extras/rust
  sudo dnf -y install cmake && cargo install starship --version 1.10.3

  # lang servers
  sudo dnf -y install pylsp rust-analyzer 
}

dnf_setup(){
  # update dnf config
  echo "max_parallel_downloads=10" | sudo tee -a /etc/dnf/dnf.conf
  echo "defaultyes=True" | sudo tee -a /etc/dnf/dnf.conf
  echo "fastestmirror=True" | sudo tee -a /etc/dnf/dnf.conf
  # add rpm fusion repositories
  sudo dnf -y install https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm
  sudo dnf -y install https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm
  sudo dnf -y upgrade
}

gnome(){
  sudo dnf -y install gnome-shell-extension-appindicator
  sudo dnf -y install gnome-shell-extension-blur-my-shell
  sudo dnf -y install gnome-shell-extension-caffeine
  sudo dnf -y install gnome-shell-extension-just-perfection
  sudo dnf -y install gnome-shell-extension-launch-new-instance
  sudo dnf -y install gnome-shell-extension-openweather
  ./extras/gnome-config
  ./extras/gnome-config-custom-keys
  sudo dnf install -y alacritty
}

gnome-ostree(){
  toolbox create
  ./extras/gnome-config
  ./extras/gnome-config-custom-keys-ostree
}

kde(){
  sudo dnf install -y alacritty
  sudo dnf install -y bismuth
}

snapper_with_dnf(){
  sudo dnf install -y snapper python3-dnf-plugin-snapper

  echo "=== PRE CONFIG"
  sudo btrfs subvolume list /
  sudo snapper -c root create-config /
  
  echo "=== POST CONFIG"
  sudo btrfs subvolume list /
  
  echo "=== REMOVE UNMOUNTED SUBVOLUME"
  sudo btrfs subvolume delete /.snapshots/
  
  sudo mkdir /.snapshots
  sudo mkdir /mnt/btrfs
  
}

virt(){
  sudo dnf install @virtualization
  sudo systemctl start libvirtd
  sudo systemctl enable libvirtd
}

menu
